<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment - Crop Monitoring System</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<header class="bg-success text-white p-3">
    <h1 class="text-center">Equipment Managing Point</h1>
</header>

<main class="container mt-4">
    <section id="equipment">
        <h2>Equipment Management</h2>
        <p>The Green Shadow Crop Monitoring System tracks all agricultural equipment utilized in crop production and maintenance.</p>

        <!-- Equipment Table -->
        <table class="table table-striped" id="equipmentTable">
            <thead>
            <tr>
                <th scope="col">Equipment ID</th>
                <th scope="col">Equipment Name</th>
                <th scope="col">Type</th>
                <th scope="col">Purchase Date</th>
                <th scope="col">Status</th>
                <th scope="col">Last Serviced</th>
                <th scope="col">Location</th>
                <th scope="col">Actions</th>
            </tr>
            </thead>
            <tbody>
            <!-- Dynamic rows will be appended here -->
            </tbody>
        </table>

        <!-- Add New Equipment Form -->
        <h4>Add New Equipment</h4>
        <form id="addEquipmentForm">
            <div class="mb-3">
                <label for="equipmentName" class="form-label">Equipment Name</label>
                <input type="text" class="form-control" id="equipmentName" required>
            </div>
            <div class="mb-3">
                <label for="equipmentType" class="form-label">Type</label>
                <input type="text" class="form-control" id="equipmentType" required>
            </div>
            <div class="mb-3">
                <label for="purchaseDate" class="form-label">Purchase Date</label>
                <input type="date" class="form-control" id="purchaseDate" required>
            </div>
            <div class="mb-3">
                <label for="status" class="form-label">Status</label>
                <select class="form-control" id="status" required>
                    <option value="Operational">Operational</option>
                    <option value="Under Maintenance">Under Maintenance</option>
                    <option value="Decommissioned">Decommissioned</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="lastServiced" class="form-label">Last Serviced</label>
                <input type="date" class="form-control" id="lastServiced" required>
            </div>
            <div class="mb-3">
                <label for="location" class="form-label">Location</label>
                <input type="text" class="form-control" id="location" required>
            </div>
            <button type="submit" class="btn btn-success">Add Equipment</button>
        </form>
    </section>
</main>

<script>
    let equipmentCount = 0; // Counter for Equipment IDs

    const renderTable = (equipmentList) => {
        const tableBody = $('#equipmentTable tbody');
        tableBody.empty();
        equipmentList.forEach((equipment, index) => {
            tableBody.append(`
                <tr>
                    <td>${equipment.id}</td>
                    <td>${equipment.name}</td>
                    <td>${equipment.type}</td>
                    <td>${equipment.purchaseDate}</td>
                    <td>${equipment.status}</td>
                    <td>${equipment.lastServiced}</td>
                    <td>${equipment.location}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editEquipment(${index})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEquipment(${index})">Delete</button>
                    </td>
                </tr>
            `);
        });
    };

    const equipmentList = []; // Temporary storage for equipment

    const addEquipment = (e) => {
        e.preventDefault();

        // Generate new Equipment ID
        equipmentCount++;
        const newEquipment = {
            id: `E${String(equipmentCount).padStart(3, '0')}`,
            name: $('#equipmentName').val(),
            type: $('#equipmentType').val(),
            purchaseDate: $('#purchaseDate').val(),
            status: $('#status').val(),
            lastServiced: $('#lastServiced').val(),
            location: $('#location').val(),
        };

        equipmentList.push(newEquipment); // Add equipment to the list
        renderTable(equipmentList); // Re-render the table
        $('#addEquipmentForm')[0].reset(); // Reset the form
    };

    const editEquipment = (index) => {
        const equipment = equipmentList[index];

        // Pre-fill the form with the selected equipment data
        $('#equipmentName').val(equipment.name);
        $('#equipmentType').val(equipment.type);
        $('#purchaseDate').val(equipment.purchaseDate);
        $('#status').val(equipment.status);
        $('#lastServiced').val(equipment.lastServiced);
        $('#location').val(equipment.location);

        // Change button text to "Update Equipment"
        $('#addEquipmentForm button').text('Update Equipment').off().click((e) => {
            e.preventDefault();

            // Update equipment details
            equipmentList[index] = {
                ...equipment,
                name: $('#equipmentName').val(),
                type: $('#equipmentType').val(),
                purchaseDate: $('#purchaseDate').val(),
                status: $('#status').val(),
                lastServiced: $('#lastServiced').val(),
                location: $('#location').val(),
            };

            renderTable(equipmentList); // Re-render the table
            $('#addEquipmentForm')[0].reset(); // Reset the form
            $('#addEquipmentForm button').text('Add Equipment').off().click(addEquipment); // Restore default button behavior
        });
    };

    const deleteEquipment = (index) => {
        equipmentList.splice(index, 1); // Remove equipment from the list
        renderTable(equipmentList); // Re-render the table
    };

    $(document).ready(() => {
        renderTable(equipmentList); // Render empty table on load
        $('#addEquipmentForm').submit(addEquipment); // Bind form submission
    });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>
