<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crops - Crop Monitoring System</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<header class="bg-success text-white p-3">
    <h1 class="text-center">Crop Monitoring System</h1>
</header>

<main class="container mt-4">
    <section id="crops">
        <h2>Crops Information</h2>

        <!-- Crop Table -->
        <table class="table table-striped" id="cropTable">
            <thead>
            <tr>
                <th scope="col">Crop Code</th>
                <th scope="col">Common Name</th>
                <th scope="col">Scientific Name</th>
                <th scope="col">Image</th>
                <th scope="col">Category</th>
                <th scope="col">Season</th>
                <th scope="col">Field</th>
                <th scope="col">Actions</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <!-- Add New Crop Form -->
        <h4>Add New Crop</h4>
        <form id="addCropForm">
            <!-- Crop Code -->
            <div class="mb-3">
                <label for="cropCode" class="form-label">Crop Code</label>
                <input type="text" class="form-control" id="cropCode" placeholder="Enter unique crop code" required>
            </div>

            <!-- Common Name -->
            <div class="mb-3">
                <label for="commonName" class="form-label">Common Name</label>
                <input type="text" class="form-control" id="commonName" placeholder="Enter common name" required>
            </div>

            <!-- Scientific Name -->
            <div class="mb-3">
                <label for="scientificName" class="form-label">Scientific Name</label>
                <input type="text" class="form-control" id="scientificName" placeholder="Enter scientific name" required>
            </div>

            <!-- Image -->
            <div class="mb-3">
                <label for="image" class="form-label">Crop Image</label>
                <input type="file" class="form-control" id="image" accept="image/*" required>
            </div>

            <!-- Category -->
            <div class="mb-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-control" id="category" required>
                    <option value="" disabled selected>Choose category</option>
                    <option value="Cereal">Cereal</option>
                    <option value="Fruit">Fruit</option>
                    <option value="Vegetable">Vegetable</option>
                    <option value="Legume">Legume</option>
                </select>
            </div>

            <!-- Season -->
            <div class="mb-3">
                <label for="season" class="form-label">Season</label>
                <select class="form-control" id="season" required>
                    <option value="" disabled selected>Choose season</option>
                    <option value="Spring">Spring</option>
                    <option value="Summer">Summer</option>
                    <option value="Autumn">Autumn</option>
                    <option value="Winter">Winter</option>
                </select>
            </div>

            <!-- Field -->
            <div class="mb-3">
                <label for="field" class="form-label">Field</label>
                <select class="form-control" id="field" required>
                    <option value="" disabled selected>Choose field</option>
                    <!-- Populate dynamically -->
                </select>
            </div>

            <button type="submit" class="btn btn-success">Add Crop</button>
        </form>
    </section>
</main>

<script>
    $(document).ready(function () {
        // Populate field dropdown dynamically from localStorage
        function populateFieldDropdown() {
            const fields = JSON.parse(localStorage.getItem('fields')) || [];
            const fieldSelect = $('#field');
            fieldSelect.empty();
            fieldSelect.append('<option value="" disabled selected>Choose field</option>');
            fields.forEach(field => {
                fieldSelect.append(`<option value="${field.fieldId}">${field.fieldName}</option>`);
            });
        }
        populateFieldDropdown();

        // Add new crop functionality
        $('#addCropForm').submit(function (event) {
            event.preventDefault();

            const crop = {
                cropCode: $('#cropCode').val(),
                commonName: $('#commonName').val(),
                scientificName: $('#scientificName').val(),
                image: $('#image')[0].files[0]?.name || 'No Image',
                category: $('#category').val(),
                season: $('#season').val(),
                field: $('#field').val(),
            };

            // Save to localStorage
            const crops = JSON.parse(localStorage.getItem('crops')) || [];
            crops.push(crop);
            localStorage.setItem('crops', JSON.stringify(crops));

            // Update table
            const newRow = `<tr>
                <td>${crop.cropCode}</td>
                <td>${crop.commonName}</td>
                <td>${crop.scientificName}</td>
                <td>${crop.image}</td>
                <td>${crop.category}</td>
                <td>${crop.season}</td>
                <td>${crop.field}</td>
                <td>
                    <button class="btn btn-primary editBtn">Edit</button>
                    <button class="btn btn-danger deleteBtn">Delete</button>
                </td>
            </tr>`;
            $('#cropTable tbody').append(newRow);

            // Clear form
            $('#addCropForm')[0].reset();
        });
    });
</script>
</body>
</html>